<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HF Historie Review Master</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- React and Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; -webkit-backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .animate-pop { animation: pop 0.3s ease-out; }
        @keyframes pop {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body class="bg-slate-50 text-slate-900 overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useMemo, useEffect, useCallback, useRef } = React;

      // --- KONFIGURATION & DATA ---
      const TOPICS = [
        { id: '0', title: '0. Historisk Metode & Teori', description: 'Kildekritik, billedanalyse, historiebrug og forklaringer p√• historiens gang.' },
        { id: '1', title: '1. Identitetsdannelse & Samfundstyper', description: 'Fra det traditionelle landsbyf√¶llesskab til det senmoderne informationssamfund.' },
        { id: '2', title: '2. Det Gode Samfund', description: 'Den politiske kamp fra enev√¶lde, gennem landboreformer, til det moderne demokrati.' },
        { id: '3', title: '3. Nazisme, Holocaust & Kold Krig', description: 'De totalit√¶re ideologier, krigens r√¶dsler og stormagtsbalancen efter 1945.' },
        { id: '4', title: '4. Kulturm√∏der', description: 'Dansk identitet i en globaliseret verden og historiske perspektiver p√• indvandring.' },
      ];

      const HISTORY_ENTRIES = [
        // TOPIC 0: METODE OG TEORI
        {
          id: 't0_1', topicId: '0', type: 'term', title: 'Prim√¶r vs Sekund√¶r kilde',
          description: 'Prim√¶r kilde: Den tidligste kilde til en begivenhed. Sekund√¶r kilde: Bygger p√• en anden (ofte prim√¶r) kilde.',
          tags: ['Metode', 'Kildekritik'],
          questions: [{ id: 'q0_1', question: 'Hvad kendetegner en prim√¶r kilde?', options: ['Den er altid skrevet af en historiker', 'Den er den tidligste kilde vi kender til begivenheden', 'Den er altid offentlig', 'Den er skrevet lang tid efter begivenheden'], correctAnswer: 'Den er den tidligste kilde vi kender til begivenheden' }]
        },
        {
          id: 't0_2', topicId: '0', type: 'term', title: 'Tendens',
          description: 'N√•r en kilde er partshaver i en konflikt og udl√¶gger sandheden p√• en s√¶rlig m√•de for at fremme egne interesser.',
          tags: ['Metode', 'Kildekritik'],
          questions: [{ id: 'q0_2', question: 'Hvad betyder det at en kilde har "tendens"?', options: ['At den er letl√¶selig', 'At den er repr√¶sentativ', 'At den udl√¶gger virkeligheden p√• en s√¶rlig, partisk m√•de', 'At den er samtidig'], correctAnswer: 'At den udl√¶gger virkeligheden p√• en s√¶rlig, partisk m√•de' }]
        },
        {
          id: 't0_3', topicId: '0', type: 'term', title: 'F√∏rsteh√•ndsberetning',
          description: 'Forfatteren var selv til stede ved de beskrevne begivenheder.',
          tags: ['Metode', 'Kildekritik'],
          questions: [{ id: 'q0_3', question: 'Hvad er en f√∏rsteh√•ndsberetning?', options: ['En kilde skrevet af √∏jenvidner', 'En kilde baseret p√• rygter', 'En kilde skrevet af en historiker 100 √•r efter', 'En lovtekst'], correctAnswer: 'En kilde skrevet af √∏jenvidner' }]
        },
        {
          id: 't0_4', topicId: '0', type: 'term', title: 'Historiebrug: Politisk',
          description: 'N√•r fortiden bruges til at retf√¶rdigg√∏re eller ford√∏mme politiske beslutninger, styreformer eller nationer.',
          tags: ['Teori', 'Historiebrug'],
          questions: [{ id: 'q0_4', question: 'Hvad er form√•let med politisk historiebrug?', options: ['Underholdning og profit', 'At finde den videnskabelige sandhed', 'Legitimering eller delegitimering af politiske holdninger', 'Identitetsskabelse'], correctAnswer: 'Legitimering eller delegitimering af politiske holdninger' }]
        },
        {
          id: 't0_5', topicId: '0', type: 'term', title: 'Historiemisbrug',
          description: 'Bevidst fordrejning, manipulation eller ben√¶gtelse af historiske kendsgerninger (f.eks. holocaustben√¶gtelse).',
          tags: ['Teori', 'Historiebrug'],
          questions: [{ id: 'q0_5', question: 'Giv et eksempel p√• historiemisbrug.', options: ['En historisk dokumentar', 'Holocaustben√¶gtelse', 'En l√¶rebog i historie', 'En mindestatue'], correctAnswer: 'Holocaustben√¶gtelse' }]
        },
        {
          id: 't0_6', topicId: '0', type: 'term', title: '√Örsagsforklaring: √òkonomien',
          description: 'Central drivkraft if√∏lge Karl Marx: Mods√¶tningsforholdet mellem dem der ejer produktionsmidlerne og dem der s√¶lger deres arbejdskraft.',
          tags: ['Teori', '√Örsagsforklaringer'],
          questions: [{ id: 'q0_6', question: 'Hvem forbindes ofte med √∏konomi som den centrale drivkraft i historien?', options: ['Adolf Hitler', 'Karl Marx', 'Frederik 3.', 'Hofstede'], correctAnswer: 'Karl Marx' }]
        },
        {
          id: 't0_7', topicId: '0', type: 'term', title: 'Billedanalyse: Motivanalyse',
          description: 'Fokus p√• om der er normer, konventioner eller en bestemt stilepoke, der p√•virker fremstillingen af motivet.',
          tags: ['Metode', 'Billedanalyse'],
          questions: [{ id: 'q0_7', question: 'Hvad unders√∏ger man i en motivanalyse af et billede?', options: ['Hvilket materiale det er lavet af', 'Normer, konventioner og stilepoker fra tiden', 'Hvor billedet befinder sig i dag', 'Billedets m√•l i cm'], correctAnswer: 'Normer, konventioner og stilepoker fra tiden' }]
        },
        {
          id: 't0_8', topicId: '0', type: 'term', title: 'Repr√¶sentativitet',
          description: 'Unders√∏gelse af om kilden repr√¶senterer et s√¶rligt standpunkt, politisk st√•sted eller en bestemt befolkningsgruppe.',
          tags: ['Metode', 'Kildekritik'],
          questions: [{ id: 'q0_8', question: 'Hvad betyder repr√¶sentativitet i kildekritik?', options: ['At kilden er p√¶n', 'Om kilden repr√¶senterer en bestemt gruppe eller standpunkt generelt', 'Hvem der har skrevet kilden', 'Hvorn√•r kilden er fra'], correctAnswer: 'Om kilden repr√¶senterer en bestemt gruppe eller standpunkt generelt' }]
        },

        // TOPIC 1
        {
          id: 't1_1', topicId: '1', type: 'term', title: 'Traditionssamfundet (Myren)',
          description: 'Et samfund pr√¶get af landbrug, landsbyf√¶llesskab og religion. Individet f√∏lger i for√¶ldrenes fodspor ("myren" i tuen).',
          tags: ['Sociologi', 'Tradition'],
          questions: [{ id: 'q1', question: 'Hvilken arketype bruges om det traditionelle menneske?', options: ['Sneglen', 'Kam√¶leonen', 'Myren', 'L√∏ven'], correctAnswer: 'Myren' }]
        },
        {
          id: 't1_2', topicId: '1', type: 'term', title: 'Det Moderne Samfund (Sneglen)',
          description: 'Industrisamfundet. Urbanisering, kernefamilie og industrialisering. Individet har sit hjem med sig ("sneglen"), men f√∏lger faste normer.',
          tags: ['Industri', 'Moderne'],
          questions: [{ id: 'q2', question: 'Hvad kendetegner det moderne menneske if√∏lge Riesman?', options: ['Traditionsstyret', 'Indrestyret', 'Andenstyret', 'Gruppestyret'], correctAnswer: 'Indrestyret' }]
        },
        {
          id: 't1_3', topicId: '1', type: 'term', title: 'Det Senmoderne Samfund (Kam√¶leonen)',
          description: 'Informationssamfundet. Globalisering, √∏get refleksivitet og formbar identitet. Individet tilpasser sig konteksten som en kam√¶leon.',
          tags: ['Giddens', 'Senmoderne'],
          questions: [{ id: 'q3', question: 'Hvad betyder "√∏get refleksivitet"?', options: ['Spejling', 'Konstant genovervejelse af valg', 'Religi√∏sitet', 'Traditionsbundethed'], correctAnswer: 'Konstant genovervejelse af valg' }]
        },
        // TOPIC 2
        {
          id: 't2_1', topicId: '2', type: 'event', title: 'Enev√¶ldens Indf√∏relse', date: '1660',
          description: 'Frederik 3. centraliserede magten hos kongen og sv√¶kkede adelen.',
          tags: ['Magt', 'Politik'],
          questions: [{ id: 'q4', question: 'Hvorn√•r blev enev√¶lden indf√∏rt i Danmark?', options: ['1660', '1849', '1788', '1536'], correctAnswer: '1660' }]
        },
        {
          id: 't2_2', topicId: '2', type: 'event', title: 'Stavnsb√•ndets L√∏sning', date: '1788',
          description: 'En del af landboreformerne, der gav b√∏nderne personlig frihed.',
          tags: ['Landboreformer', 'Frihed'],
          questions: [{ id: 'q5', question: 'Hvad var hovedm√•let med stavnsb√•ndets l√∏sning?', options: ['Krig', 'Frig√∏relse af arbejdskraft', 'Kvindevalgret', 'Skatteindf√∏relse'], correctAnswer: 'Frig√∏relse af arbejdskraft' }]
        },
        {
          id: 't2_3', topicId: '2', type: 'event', title: 'Grundloven', date: '1849',
          description: 'Afslutningen p√• enev√¶lden og indf√∏relsen af demokrati.',
          tags: ['Demokrati', 'Politik'],
          questions: [{ id: 'q6', question: 'Hvilken dato blev den f√∏rste Grundlov underskrevet?', options: ['5. juni', '4. maj', '24. december', '1. januar'], correctAnswer: '5. juni' }]
        },
        // TOPIC 3
        {
          id: 't3_1', topicId: '3', type: 'term', title: 'Holocaust',
          description: 'Systematisk statsligt organiseret folkedrab p√• ca. 6 millioner j√∏der under 2. verdenskrig.',
          tags: ['Krig', 'Folkedrab'],
          questions: []
        },
        {
          id: 't3_2', topicId: '3', type: 'event', title: 'Berlinmurens Fald', date: '1989',
          description: 'Symboliserede afslutningen p√• Den Kolde Krig og jernt√¶ppets fald.',
          tags: ['Kold Krig', 'Europa'],
          questions: [{ id: 'q7', question: 'Hvorn√•r faldt Berlinmuren?', options: ['1945', '1961', '1989', '1991'], correctAnswer: '1989' }]
        },
        // TOPIC 4
        {
          id: 't4_1', topicId: '4', type: 'term', title: 'Hofstedes L√∏gmodel',
          description: 'Model til at forst√• kultur gennem lag: Symboler, Helte, Ritualer og V√¶rdier.',
          tags: ['Kultur', 'Teori'],
          questions: [{ id: 'q8', question: 'Hvad er det inderste lag i l√∏gmodellen?', options: ['Symboler', 'Helte', 'V√¶rdier', 'Ritualer'], correctAnswer: 'V√¶rdier' }]
        }
      ];

      // --- LOGIK FOR HUKOMMELSE (SRS) ---
      const getStatsKey = (user) => `hf_history_stats_v3_${user.toLowerCase()}`;

      const updateSRS = (currentStats, entryId, quality, responseTimeMs, mode) => {
        const stats = currentStats[entryId] || { 
            interval: 0, ease: 2.5, repetitions: 0, 
            flashcardMastery: 0, quizAccuracy: [], timelineAccuracy: [], history: [] 
        };
        
        let { interval, ease, repetitions, flashcardMastery, quizAccuracy, timelineAccuracy } = stats;

        if (mode === 'quiz') {
            const correct = quality >= 2 ? 1 : 0;
            quizAccuracy = [...(quizAccuracy || []).slice(-9), correct];
        } else if (mode === 'timeline') {
            const correct = quality >= 2 ? 1 : 0;
            timelineAccuracy = [...(timelineAccuracy || []).slice(-9), correct];
        }

        if (quality >= 2) { 
          if (repetitions === 0) interval = 1;
          else if (repetitions === 1) interval = 6;
          else interval = Math.round(interval * ease);
          repetitions++;
        } else { 
          repetitions = 0;
          interval = 1;
        }

        const speedBonus = (quality >= 3 && responseTimeMs < 5000) ? 0.1 : 0;
        ease = ease + (0.1 - (3 - quality) * (0.08 + (3 - quality) * 0.02)) + speedBonus;
        if (ease < 1.3) ease = 1.3;

        flashcardMastery = Math.min(100, repetitions * 20);

        return {
          ...currentStats,
          [entryId]: {
            ...stats,
            interval, ease, repetitions, flashcardMastery, quizAccuracy, timelineAccuracy,
            lastSeen: Date.now(),
            nextDue: Date.now() + (interval * 24 * 60 * 60 * 1000),
            history: [...(stats.history || []).slice(-10), { quality, time: responseTimeMs, date: Date.now(), mode }]
          }
        };
      };

      const shuffleWithPriority = (entries, stats) => {
        return [...entries].sort((a, b) => {
          const statsA = stats[a.id] || { nextDue: 0, repetitions: 0 };
          const statsB = stats[b.id] || { nextDue: 0, repetitions: 0 };
          if (statsA.repetitions === 0 && statsB.repetitions !== 0) return -1;
          if (statsB.repetitions === 0 && statsA.repetitions !== 0) return 1;
          return statsA.nextDue - statsB.nextDue;
        });
      };

      // --- KOMPONENTER ---

      const TopicCard = ({ topic, isSelected, onClick, count, stats }) => {
        const entries = HISTORY_ENTRIES.filter(e => e.topicId === topic.id);
        const fMastery = entries.reduce((acc, e) => acc + (stats[e.id]?.flashcardMastery || 0), 0) / entries.length;
        const qAccs = entries.flatMap(e => stats[e.id]?.quizAccuracy || []);
        const qMastery = qAccs.length > 0 ? (qAccs.reduce((a, b) => a + b, 0) / qAccs.length) * 100 : 0;

        return (
          <button
            onClick={onClick}
            className={`p-6 rounded-2xl border-2 transition-all text-left w-full flex flex-col group relative overflow-hidden ${
              isSelected ? 'border-indigo-600 bg-white shadow-xl ring-2 ring-indigo-100' : 'border-slate-200 bg-white hover:border-indigo-300 hover:shadow-md'
            }`}
          >
            <div className="flex justify-between items-start mb-4">
              <span className="px-2 py-1 bg-indigo-50 text-indigo-600 text-[10px] font-black rounded-lg uppercase tracking-wider">Emne {topic.id}</span>
              <span className="text-slate-400 text-[10px] font-black uppercase">{count} kort</span>
            </div>
            
            <h3 className="text-lg font-black text-slate-800 mb-2 leading-tight group-hover:text-indigo-600 transition-colors">{topic.title}</h3>
            <p className="text-xs text-slate-500 line-clamp-2 mb-6 leading-relaxed">{topic.description}</p>
            
            <div className="mt-auto space-y-3">
              <div>
                <div className="flex justify-between text-[9px] font-black uppercase text-slate-400 mb-1">
                  <span>Hukommelse</span>
                  <span className={fMastery > 50 ? 'text-emerald-500' : ''}>{Math.round(fMastery)}%</span>
                </div>
                <div className="h-1.5 w-full bg-slate-100 rounded-full overflow-hidden">
                  <div className="h-full bg-indigo-500 transition-all duration-700" style={{width: `${fMastery}%`}}></div>
                </div>
              </div>
              <div>
                <div className="flex justify-between text-[9px] font-black uppercase text-slate-400 mb-1">
                  <span>Quiz-niveau</span>
                  <span className={qMastery > 50 ? 'text-emerald-500' : ''}>{Math.round(qMastery)}%</span>
                </div>
                <div className="h-1.5 w-full bg-slate-100 rounded-full overflow-hidden">
                  <div className="h-full bg-emerald-400 transition-all duration-700" style={{width: `${qMastery}%`}}></div>
                </div>
              </div>
            </div>
          </button>
        );
      };

      const FlashcardView = ({ entries, onExit, onRecord }) => {
        const [sessionEntries] = useState(() => [...entries]);
        const [currentIndex, setCurrentIndex] = useState(0);
        const [isFlipped, setIsFlipped] = useState(false);
        const startTime = useRef(Date.now());
        const entry = sessionEntries[currentIndex];

        useEffect(() => {
          startTime.current = Date.now();
          setIsFlipped(false);
        }, [currentIndex]);

        if (!sessionEntries.length) return <div className="p-12 text-center font-bold">Ingen kort valgt.</div>;

        const handleRating = (quality) => {
          const duration = Date.now() - startTime.current;
          onRecord(entry.id, quality, duration, 'flashcard');
          if (currentIndex < sessionEntries.length - 1) {
            setCurrentIndex(currentIndex + 1);
          } else {
            onExit();
          }
        };

        return (
          <div className="max-w-xl mx-auto py-8 px-4 animate-pop">
            <div className="flex justify-between items-center mb-8">
              <button onClick={onExit} className="text-slate-400 hover:text-slate-800 font-black text-xs uppercase tracking-widest">‚úï Afslut</button>
              <span className="text-xs font-black text-slate-300 uppercase tracking-widest">{currentIndex + 1} / {sessionEntries.length}</span>
            </div>
            <div className="relative perspective-1000 h-96 cursor-pointer" onClick={() => setIsFlipped(!isFlipped)}>
              <div className={`relative w-full h-full transition-all duration-500 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
                <div className="absolute inset-0 backface-hidden bg-white rounded-3xl shadow-2xl border-2 border-slate-50 flex flex-col items-center justify-center p-10 text-center">
                  <span className="px-3 py-1 bg-slate-100 text-slate-500 rounded-full text-[10px] font-black uppercase mb-6 tracking-widest border border-slate-200">{entry.type === 'event' ? 'Begivenhed' : 'Begreb'}</span>
                  <h2 className="text-3xl font-black text-slate-800 leading-tight">{entry.title}</h2>
                  {entry.date && <p className="mt-6 text-2xl font-black text-indigo-600">{entry.date}</p>}
                </div>
                <div className="absolute inset-0 backface-hidden rotate-y-180 bg-slate-900 rounded-3xl shadow-2xl p-10 flex flex-col items-center justify-center text-center text-white">
                  <p className="text-xl leading-relaxed font-medium">{entry.description}</p>
                </div>
              </div>
            </div>
            {isFlipped && (
              <div className="grid grid-cols-3 gap-3 mt-10 animate-pop">
                <button onClick={() => handleRating(0)} className="bg-white border-2 border-rose-100 text-rose-600 py-4 rounded-2xl font-black shadow-sm hover:bg-rose-50 transition-all flex flex-col items-center">
                  <span>Sv√¶rt</span>
                </button>
                <button onClick={() => handleRating(2)} className="bg-white border-2 border-indigo-100 text-indigo-600 py-4 rounded-2xl font-black shadow-sm hover:bg-indigo-50 transition-all flex flex-col items-center">
                  <span>Okay</span>
                </button>
                <button onClick={() => handleRating(3)} className="bg-emerald-500 text-white py-4 rounded-2xl font-black shadow-lg hover:bg-emerald-600 transition-all flex flex-col items-center">
                  <span>Nemt</span>
                </button>
              </div>
            )}
          </div>
        );
      };

      const QuizView = ({ entries, onExit, onRecord }) => {
        const [sessionQuestions] = useState(() => 
          entries.flatMap(e => e.questions.map(q => ({ ...q, entryId: e.id, entryTitle: e.title })))
        );
        const [idx, setIdx] = useState(0);
        const [sel, setSel] = useState(null);
        const [done, setDone] = useState(false);
        const [score, setScore] = useState(0);
        const [res, setRes] = useState(false);
        const startTime = useRef(Date.now());

        useEffect(() => {
          startTime.current = Date.now();
        }, [idx]);

        if (!sessionQuestions.length) return <div className="p-12 text-center font-bold">Ingen sp√∏rgsm√•l fundet.</div>;
        const q = sessionQuestions[idx];

        const handleSelect = (o) => {
          if (done) return;
          const duration = Date.now() - startTime.current;
          setSel(o); setDone(true);
          const isCorrect = o === q.correctAnswer;
          if (isCorrect) setScore(s => s + 1);
          const quality = isCorrect ? (duration < 5000 ? 3 : 2) : 0;
          onRecord(q.entryId, quality, duration, 'quiz');
        };

        if (res) return (
          <div className="max-w-md mx-auto py-16 text-center animate-pop px-6">
            <h2 className="text-5xl font-black text-slate-900 mb-10 tracking-tighter italic">F√¶rdig!</h2>
            <div className="bg-white rounded-[2.5rem] p-12 border-2 border-slate-50 shadow-2xl mb-10">
                <div className="text-8xl font-black text-indigo-600 mb-2">{Math.round((score/sessionQuestions.length)*100)}%</div>
                <p className="text-slate-400 font-black uppercase tracking-[0.2em] text-[10px]">Din pr√¶cision</p>
            </div>
            <button onClick={onExit} className="w-full py-6 bg-slate-900 text-white rounded-3xl font-black shadow-2xl hover:bg-slate-800 transition-all active:scale-95">Afslut</button>
          </div>
        );

        return (
          <div className="max-w-2xl mx-auto py-8 px-4 animate-pop">
            <div className="flex justify-between items-center mb-8">
              <button onClick={onExit} className="text-slate-400 font-black text-xs uppercase tracking-widest">‚úï Afbryd</button>
              <span className="text-[10px] font-black text-slate-300 uppercase tracking-widest">Sp√∏rgsm√•l {idx + 1} / {sessionQuestions.length}</span>
            </div>
            <div className="bg-white p-12 rounded-[2.5rem] border-2 border-slate-50 shadow-2xl mb-8 relative overflow-hidden">
              <div className="absolute top-0 left-0 h-1.5 bg-indigo-600 transition-all duration-700" style={{width: `${((idx + 1)/sessionQuestions.length)*100}%`}}></div>
              <p className="text-[10px] font-black text-indigo-500 uppercase mb-4 tracking-[0.2em]">{q.entryTitle}</p>
              <h2 className="text-2xl font-black mb-12 text-slate-800 leading-tight">{q.question}</h2>
              <div className="space-y-4">
                {q.options.map(o => (
                  <button key={o} onClick={() => handleSelect(o)} disabled={done} className={`w-full p-6 text-left rounded-2xl border-2 transition-all font-bold ${done ? (o === q.correctAnswer ? 'border-emerald-500 bg-emerald-50 text-emerald-700 shadow-sm' : (o === sel ? 'border-rose-500 bg-rose-50 text-rose-700' : 'border-slate-50 opacity-30')) : 'border-slate-100 bg-white hover:border-indigo-400'}`}>
                    <span>{o}</span>
                  </button>
                ))}
              </div>
            </div>
            {done && <button onClick={() => { if (idx < sessionQuestions.length - 1) { setIdx(idx + 1); setSel(null); setDone(false); } else { setRes(true); } }} className="w-full py-6 bg-indigo-600 text-white rounded-3xl font-black shadow-xl hover:bg-indigo-700 transition-all active:scale-95 animate-pop">N√¶ste ‚Üí</button>}
          </div>
        );
      };

      const TimelineView = ({ entries, onExit, onRecord }) => {
        const eventEntries = useMemo(() => entries.filter(e => e.date), [entries]);
        const [pool, setPool] = useState([]);
        const [placed, setPlaced] = useState([]);
        const [active, setActive] = useState(null);
        const [feedback, setFeedback] = useState(null);
        const startTime = useRef(Date.now());

        useEffect(() => {
          if (eventEntries.length < 3) return;
          const sorted = [...eventEntries].sort(() => Math.random() - 0.5);
          const initial = sorted.slice(0, 2).sort((a, b) => parseInt(a.date) - parseInt(b.date));
          setPlaced(initial);
          setPool(sorted.slice(2));
          setActive(sorted[2] || null);
          startTime.current = Date.now();
        }, [eventEntries]);

        if (eventEntries.length < 3) return <div className="p-12 text-center font-bold">For f√• begivenheder til tidslinje.</div>;

        const handlePlace = (index) => {
          if (feedback) return;
          const isCorrect = 
            (index === 0 && parseInt(active.date) < parseInt(placed[0].date)) ||
            (index === placed.length && parseInt(active.date) > parseInt(placed[placed.length - 1].date)) ||
            (index > 0 && index < placed.length && parseInt(active.date) > parseInt(placed[index-1].date) && parseInt(active.date) < parseInt(placed[index].date));

          const duration = Date.now() - startTime.current;
          onRecord(active.id, isCorrect ? 3 : 0, duration, 'timeline');

          if (isCorrect) {
            setFeedback({ type: 'success', index });
            setTimeout(() => {
              const nextPlaced = [...placed];
              nextPlaced.splice(index, 0, active);
              setPlaced(nextPlaced);
              const nextPool = pool.slice(1);
              setPool(nextPool);
              setActive(nextPool[0] || null);
              setFeedback(null);
              startTime.current = Date.now();
            }, 800);
          } else {
            setFeedback({ type: 'error', index });
            setTimeout(() => setFeedback(null), 1000);
          }
        };

        if (!active && pool.length === 0 && placed.length > 2) return (
            <div className="max-w-md mx-auto py-16 text-center animate-pop">
                <h2 className="text-5xl font-black mb-8 italic">Flot klaret!</h2>
                <div className="bg-white p-10 rounded-[2.5rem] border-2 shadow-2xl mb-8">
                    <p className="text-slate-400 font-black uppercase text-xs mb-4">Du f√¶rdiggjorde tidslinjen med</p>
                    <div className="text-6xl font-black text-indigo-600">{placed.length}</div>
                    <p className="text-slate-400 font-black uppercase text-[10px] mt-2 tracking-widest">Korrekt placerede begivenheder</p>
                </div>
                <button onClick={onExit} className="w-full py-6 bg-slate-900 text-white rounded-3xl font-black">Tilbage</button>
            </div>
        );

        return (
          <div className="max-w-4xl mx-auto py-8 px-4 flex flex-col items-center">
            <div className="w-full flex justify-between items-center mb-10">
              <button onClick={onExit} className="text-slate-400 font-black text-xs uppercase tracking-widest">‚úï Afslut</button>
              <div className="flex gap-2">
                {pool.map((_, i) => <div key={i} className="w-1.5 h-1.5 bg-slate-200 rounded-full"></div>)}
              </div>
            </div>

            {active && (
              <div className="bg-white p-8 rounded-3xl border-2 border-indigo-500 shadow-2xl text-center mb-12 animate-pop max-w-sm w-full">
                <span className="text-[10px] font-black text-indigo-400 uppercase tracking-widest block mb-2">Hvor h√∏rer denne til?</span>
                <h2 className="text-2xl font-black text-slate-800">{active.title}</h2>
              </div>
            )}

            <div className="w-full flex flex-nowrap overflow-x-auto pb-10 gap-2 scrollbar-hide justify-center items-center">
              <div className="flex-shrink-0">
                <button onClick={() => handlePlace(0)} className={`w-8 h-8 rounded-full flex items-center justify-center transition-all ${feedback?.type === 'error' && feedback.index === 0 ? 'bg-rose-500 scale-125' : 'bg-indigo-100 text-indigo-500 hover:bg-indigo-600 hover:text-white'}`}>+</button>
              </div>
              {placed.map((item, idx) => (
                <React.Fragment key={item.id}>
                  <div className="flex-shrink-0 w-36 bg-white p-4 rounded-2xl border border-slate-200 shadow-md text-center transform transition-all duration-500 animate-pop">
                    <p className="text-xs font-black text-indigo-600 mb-1">{item.date}</p>
                    <p className="text-[10px] font-bold text-slate-800 line-clamp-2 leading-tight">{item.title}</p>
                  </div>
                  <div className="flex-shrink-0">
                    <button onClick={() => handlePlace(idx + 1)} className={`w-8 h-8 rounded-full flex items-center justify-center transition-all ${feedback?.type === 'error' && feedback.index === idx+1 ? 'bg-rose-500 scale-125' : 'bg-indigo-100 text-indigo-500 hover:bg-indigo-600 hover:text-white'}`}>+</button>
                  </div>
                </React.Fragment>
              ))}
            </div>
            
            <p className="mt-8 text-slate-400 text-[10px] font-black uppercase tracking-widest text-center">Klik p√• et "+" for at placere begivenheden p√• tidslinjen</p>
          </div>
        );
      };

      const App = () => {
        const [user, setUser] = useState('Elev');
        const [stats, setStats] = useState({});
        const [selIds, setSelIds] = useState([]);
        const [view, setView] = useState('menu');

        useEffect(() => {
          const saved = localStorage.getItem(getStatsKey(user));
          if (saved) setStats(JSON.parse(saved));
          else setStats({});
        }, [user]);

        const handleRecord = useCallback((entryId, quality, time, mode) => {
          setStats(prev => {
            const next = updateSRS(prev, entryId, quality, time, mode);
            localStorage.setItem(getStatsKey(user), JSON.stringify(next));
            return next;
          });
        }, [user]);

        const resetProgress = () => {
            if (confirm('Slet al fremgang?')) { setStats({}); localStorage.removeItem(getStatsKey(user)); }
        };

        const filtered = useMemo(() => {
          const pool = selIds.length ? HISTORY_ENTRIES.filter(e => selIds.includes(e.topicId)) : HISTORY_ENTRIES;
          return shuffleWithPriority(pool, stats);
        }, [selIds, stats]);

        const modeMastery = useMemo(() => {
            const pool = selIds.length ? HISTORY_ENTRIES.filter(e => selIds.includes(e.topicId)) : HISTORY_ENTRIES;
            if (!pool.length) return { flashcard: 0, quiz: 0, timeline: 0 };
            
            const f = pool.reduce((acc, e) => acc + (stats[e.id]?.flashcardMastery || 0), 0) / pool.length;
            const qAll = pool.flatMap(e => stats[e.id]?.quizAccuracy || []);
            const q = qAll.length ? (qAll.reduce((a,b)=>a+b, 0) / qAll.length) * 100 : 0;
            const tAll = pool.flatMap(e => stats[e.id]?.timelineAccuracy || []);
            const t = tAll.length ? (tAll.reduce((a,b)=>a+b, 0) / tAll.length) * 100 : 0;
            
            return { flashcard: f, quiz: q, timeline: t };
        }, [selIds, stats]);

        if (view === 'flashcards') return <FlashcardView entries={filtered} onExit={() => setView('menu')} onRecord={handleRecord} />;
        if (view === 'quiz') return <QuizView entries={filtered} onExit={() => setView('menu')} onRecord={handleRecord} />;
        if (view === 'timeline') return <TimelineView entries={filtered} onExit={() => setView('menu')} onRecord={handleRecord} />;

        return (
          <div className="min-h-screen pb-48">
            <header className="bg-white border-b border-slate-100 py-12 px-6">
              <div className="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-8">
                <div className="text-center md:text-left">
                    <h1 className="text-5xl font-black text-slate-900 mb-2 tracking-tighter italic">HF <span className="text-indigo-600">Historie</span></h1>
                    <p className="text-slate-400 text-xs font-black uppercase tracking-[0.3em]">Review & Tr√¶ning</p>
                </div>
                <div className="flex items-center gap-4 bg-slate-50 p-2 rounded-3xl border border-slate-200">
                    <div className="px-5 py-2">
                        <span className="text-[9px] font-black text-slate-400 uppercase block mb-1">Studerende</span>
                        <input value={user} onChange={(e) => setUser(e.target.value)} className="bg-transparent font-black text-slate-800 outline-none w-28 text-sm" />
                    </div>
                    <button onClick={resetProgress} className="bg-white px-5 py-3 rounded-2xl text-[10px] font-black text-rose-500 shadow-sm border border-slate-100 uppercase tracking-widest">Slet</button>
                </div>
              </div>
            </header>

            <main className="max-w-6xl mx-auto p-6 mt-10">
              <section className="mb-20">
                <h2 className="text-3xl font-black text-slate-800 mb-10 italic">1. V√¶lg fokus</h2>
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                  {TOPICS.map(t => (
                    <TopicCard key={t.id} topic={t} stats={stats} isSelected={selIds.includes(t.id)} count={HISTORY_ENTRIES.filter(e => e.topicId === t.id).length} onClick={() => setSelIds(s => s.includes(t.id) ? s.filter(x => x !== t.id) : [...s, t.id])} />
                  ))}
                </div>
              </section>

              <section>
                <h2 className="text-3xl font-black text-slate-800 mb-10 italic">2. Tr√¶n nu</h2>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                  {/* Flashcards */}
                  <button onClick={() => setView('flashcards')} className="group bg-white p-10 rounded-[2.5rem] border-2 border-slate-50 hover:border-indigo-500 shadow-2xl transition-all text-center relative flex flex-col items-center">
                    <div className="text-6xl mb-6 group-hover:scale-110 transition-all">üóÇÔ∏è</div>
                    <h3 className="text-2xl font-black mb-2">Flashcards</h3>
                    <p className="text-xs text-slate-400 font-medium mb-6">Fokuser p√• begreber og √•rstal.</p>
                    <div className="mt-auto flex items-center justify-center w-full gap-4">
                        <div className="flex-1 h-1.5 bg-slate-100 rounded-full overflow-hidden">
                            <div className="h-full bg-indigo-500" style={{width: `${modeMastery.flashcard}%`}}></div>
                        </div>
                        <span className="text-[10px] font-black text-slate-400">{Math.round(modeMastery.flashcard)}%</span>
                    </div>
                  </button>

                  {/* Quiz */}
                  <button onClick={() => setView('quiz')} className="group bg-white p-10 rounded-[2.5rem] border-2 border-slate-50 hover:border-indigo-500 shadow-2xl transition-all text-center relative flex flex-col items-center">
                    <div className="text-6xl mb-6 group-hover:rotate-6 transition-all">üéØ</div>
                    <h3 className="text-2xl font-black mb-2">Eksamens Quiz</h3>
                    <p className="text-xs text-slate-400 font-medium mb-6">Test viden under tidspres.</p>
                    <div className="mt-auto flex items-center justify-center w-full gap-4">
                        <div className="flex-1 h-1.5 bg-slate-100 rounded-full overflow-hidden">
                            <div className="h-full bg-emerald-400" style={{width: `${modeMastery.quiz}%`}}></div>
                        </div>
                        <span className="text-[10px] font-black text-slate-400">{Math.round(modeMastery.quiz)}%</span>
                    </div>
                  </button>

                  {/* Timeline */}
                  <button onClick={() => setView('timeline')} className="group bg-white p-10 rounded-[2.5rem] border-2 border-slate-50 hover:border-indigo-500 shadow-2xl transition-all text-center relative flex flex-col items-center">
                    <div className="text-6xl mb-6 group-hover:-translate-y-2 transition-all">‚è≥</div>
                    <h3 className="text-2xl font-black mb-2">Tidslinje</h3>
                    <p className="text-xs text-slate-400 font-medium mb-6">Placer historiske begivenheder korrekt.</p>
                    <div className="mt-auto flex items-center justify-center w-full gap-4">
                        <div className="flex-1 h-1.5 bg-slate-100 rounded-full overflow-hidden">
                            <div className="h-full bg-amber-400" style={{width: `${modeMastery.timeline}%`}}></div>
                        </div>
                        <span className="text-[10px] font-black text-slate-400">{Math.round(modeMastery.timeline)}%</span>
                    </div>
                  </button>
                </div>
              </section>
            </main>

            <footer className="fixed bottom-0 inset-x-0 p-8 flex justify-center pointer-events-none z-50">
                <div className="bg-slate-900 text-white px-10 py-6 rounded-[2rem] shadow-2xl flex items-center justify-between border border-slate-800 pointer-events-auto animate-pop max-w-3xl w-full">
                    <div className="flex gap-10">
                        <div>
                            <span className="text-[9px] font-black text-indigo-400 uppercase block tracking-[0.2em] mb-1">Session</span>
                            <span className="font-black text-2xl">{filtered.length} <span className="text-[10px] text-slate-500 uppercase font-bold tracking-widest ml-1 italic">Kort</span></span>
                        </div>
                        <div>
                            <span className="text-[9px] font-black text-emerald-400 uppercase block tracking-[0.2em] mb-1">Gns. Mestring</span>
                            <span className="font-black text-2xl">{Math.round((modeMastery.flashcard + modeMastery.quiz + modeMastery.timeline) / 3)}%</span>
                        </div>
                    </div>
                    <div className="px-6 py-3 bg-white/5 rounded-2xl border border-white/10 hidden md:block">
                        <p className="text-[9px] font-black uppercase text-indigo-300 italic">Eksamen: Juni 2025</p>
                    </div>
                </div>
            </footer>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
</body>
</html>